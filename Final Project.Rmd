---
title: "Final Project"
author: "Nathan Holterhoff, Taylor Kelly, Anthony Liu"
date: "`r Sys.Date()`"
output: html_document

---




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#install.packages("tidyverse")
# install.packages("scales")
library(scales)
library(readxl)
library(dplyr)
library(ggplot2)
library(stringr)
library(maps)

```

```{r}
file_path <- 'IAC_Database_20240514.xlsx'
sheet_names <- excel_sheets(file_path)

naics_codes <-  read_excel("2-6 digit_2022_Codes.xlsx")

arc_codes <- read.csv('ARC_List_Full_Extracted.csv')

arc_codes <- arc_codes %>%
  select(Code, Description)


# names(naics_codes)
# naics_codes <- read.csv("naics.csv")
naics_codes <- naics_codes %>%
  select("2022 NAICS US   Code", "2022 NAICS US Title")
names(naics_codes)[names(naics_codes) == "2022 NAICS US   Code"] <- 'NAICS'
names(naics_codes)[names(naics_codes) == "2022 NAICS US Title"] <- 'US_TITLE'
naics_codes$NAICS <- as.numeric(naics_codes$NAICS)
head(naics_codes)
# Initialize a list to hold all data frames
data_frames <- list()

# Loop through each sheet name and read the sheet into a data frame
for (sheet_name in sheet_names) {
  data_frames[[sheet_name]] <- read_excel(file_path, sheet = sheet_name, guess_max = 10000)
}
head(data_frames)

```

# Abstract

This report analyzes energy assessment data from Industrial Assessment Centers (IACs) to identify energy savings opportunities across varied industries in Washington. By leveraging detailed statistical analysis and data visualizations, we examined energy consumption trends and efficiency recommendations. Key findings reveal significant potential savings, particularly in Washington state. Our analysis highlights critical areas where energy efficiency can be markedly improved, providing a targeted roadmap for future IAC assessments and initiatives.

# Introduction

The Industrial Assessment Centers (IAC) program plays a crucial role in helping small and medium-sized manufacturers in the United States enhance their energy efficiency, productivity, and waste reduction efforts. The IAC data offers a comprehensive overview of various assessments, recommendations, and implementations aimed at achieving these goals. By examining the IAC data, we can uncover patterns and insights that may lead to improved practices in energy management and sustainability within the manufacturing sector in Washington state.

Existing literature and media highlight the importance of energy efficiency and waste reduction as key components of sustainable manufacturing. The IAC program, funded by the Department of Energy, has been instrumental in providing no-cost technical assessments to small and medium-sized enterprises (SMEs) across the U.S. Studies have shown that the recommendations from IAC assessments result in substantial energy savings and cost reductions for participating manufacturers. Additionally, there is a growing trend toward adopting advanced technologies and practices to enhance efficiency and reduce environmental impact in manufacturing.

Our analysis of the IAC dataset aims to answer several key questions that can provide valuable insights into the program's effectiveness and the broader implications for sustainable manufacturing. Firstly, we seek to identify the most common recommendations provided by IAC assessments and how they vary across different industries in Washington state. Secondly, we aim to quantify the total cost savings and energy savings achieved by assessments and centers, examining how these metrics vary by region. Thirdly, we will explore the ratio of sales and savings of IAC companies over time and the factors influencing these rates.

This analysis is significant for several reasons. It can inform policymakers and stakeholders about the effectiveness of the IAC program and help shape future energy efficiency initiatives. Manufacturers can benefit from understanding which recommendations have been most effective in similar contexts, aiding in the adoption of best practices. Furthermore, this study contributes to broader efforts to reduce the environmental impact of manufacturing industries, aligning with global sustainability goals. By identifying cost-saving measures, this research can also help manufacturers reduce operational costs, thereby improving their competitiveness and financial health. Ultimately, this analysis will provide valuable insights into the IAC program's impact, guiding future improvements and fostering a more sustainable manufacturing sector.

# Data

### Explanation of the Data

The datasets utilized for this project comes from the Industrial Assessment Centers (IAC) program. These datasets include detailed information on the assessments conducted, the recommendations given, and the implementations of those recommendations. It serves as a rich source of information, allowing for an in-depth analysis of energy efficiency practices and their outcomes in the manufacturing sector. Although the Assessments and Companies are stored in 1 excel file, there are 5 sheets each with different metrics and 1 common Assessment ID. This dataset can be found at https://iac.university/download. To help clarify some of the terms in the databases, we used the US Census Bureau's database of NAICS codes (https://www.census.gov/naics/?48967) to identfify industries beyond numbers. To understand the Assessment Recommendation codes in the dataset, we used ChatGPT to create a csv of terms from this PDF on IAC website (https://iac.university/technicalDocs/IAC_DatabaseManualv10.2.pdf).

We chose these datasets because they offers valuable insights into the effectiveness of the IAC recommendations. By analyzing this data, we can identify common areas for improvement in manufacturing processes, quantify the financial and energy savings achieved, and inform future energy efficiency initiatives. This analysis is particularly relevant given the increasing emphasis on sustainability and efficient resource utilization in manufacturing.

The data is freely available to the public and can be accessed through the IAC's official website: [IAC Database](https://iac.university/). There are no restrictions on the use of this data, making it accessible for both academic and commercial purposes. The dataset covers various aspects of the IAC assessments, including details about the assessments, the recommendations provided, and the implementation status of those recommendations. The population for this dataset includes small and medium-sized manufacturers across the United States that have received assessments from the IAC program.

While the datasets are comprehensive, they do have some data quality issues. There are inconsistent data entries and changes to the structure over the last 30 years. There is missing data for certain assessments or recommendations, and a time lag between when assessments are conducted and when the data is entered into the database. Since the data has been collected over 30 years, some metrics have changed within the program and more recent assignments are more detailed than prior assessments. Despite these issues, the dataset remains a valuable resource for analyzing energy efficiency practices in the manufacturing sector.

The Data comes in 1 .xls file with 6 seperate sheets. The first sheet is a list of anonymous companies with metrics about about their operations and the amount of recommendations that they had. The data can be combined using the `ID` to compare metrics about the companies assessed and the recommendations they receive. Currently no recommendation has company data assoicated with it other than `ID`. The NACIS codes come in 1 excel file and can be combined using the NACIS code column.The ARC codes can be joined by ARC2 from the csv file created by ChatGPT.

## Introduction to the Data

This report analyzes datasets provided by the Industrial Assessment Centers (IAC) program. These datasets are instrumental for studying energy efficiency practices and their outcomes in the manufacturing sector.

### Source and Data Availability

- **Collector**: Data collected by the Industrial Assessment Centers (IAC), supported by the Department of Energy.
- **Access**: Data is publicly available and can be accessed here: [IAC Database](https://iac.university/). There are no restrictions on its use, making it available for both academic and commercial purposes.

### Dataset Overview

- **Content**: The dataset includes detailed records from energy assessments across various manufacturing sites:
  - `ASSESS`: General information about each assessment.
  - `RECC1 to RECC6`: Specific energy-saving recommendations.
  - `Terms`: Definitions and terminologies used within the dataset.
- **Population and Sample**:
  - **Population**: Small and medium-sized manufacturing facilities in the U.S.
  - **Sample**: Each record represents an individual assessment conducted by the IAC.

## Data Explanation and Description

### Data Structure and Quality

**Dimensions and Structure**:
- **Total Sheets**: `r length(sheet_names)`, including details and recommendations.
- **General Dimensions**:
  - ASSESS sheet: `r nrow(data_frames[['ASSESS']])` rows x `r ncol(data_frames[['ASSESS']])` columns
  - RECC sheets: Each approximately `r nrow(data_frames[['RECC1']])` rows x `r ncol(data_frames[['RECC1']])` columns

**Variables and Coding**:
- **Key Variables**: Include identifiers, dates, types of recommendations, potential and actual savings, implementation status.
- **Coding**: Numerically and categorically coded variables.
- **Column names**: 

 The Column for ACCESS can be seen below
```{r}

for (i in 1:nrow(data_frames[['Terms']])){
  cat(data_frames[['Terms']][['ASSESS Terms']][i],": ", data_frames[['Terms']][[2]][i], '\n')
}

```

 The Column for RECC can be seen below
```{r}

for (i in 1:nrow(data_frames[['Terms']])) {
  term <- data_frames[['Terms']][['RECC Terms']][i]
  description <- data_frames[['Terms']][[5]][i]
  if (!is.na(term) && !is.na(description)) {
    cat(term, ": ", description, '\n')
  }
}

```
                   
**Data Quality Issues**:
- **Missing Data**: Notable in implementation status and metrics.
- **Inconsistencies and Anomalies**: Variability in entries and some columns with mixed data types.

### Handling Data Quality Issues

To ensure the integrity of our analysis:

- **Consistency Checks**: All columns were presented in the same format with similar data structures.

- **Missing Data Handling**: We only selected columns that were needed for the calculation and removed rows that contained NAs. 


- **Data Conversion**: Convert mixed-type columns to text or numeric in cleanup based on column type.



## Methods

### Data Selection and Variables Included

The analysis primarily focused on data provided by Industrial Assessment Centers (IACs), which conduct assessments to identify potential energy savings, waste reduction, and productivity improvements in manufacturing. The variables selected for inclusion were:

- **US_TITLE (Industry Title)** and **NAICS (North American Industry Classification System) codes**: Used to categorize assessments by industry type, allowing for sector-specific analysis.
- **ARC2 (Assessment Recommendation Code)**: Included to evaluate specific energy-saving recommendations and their impacts.
- **PSAVED, SSAVED, TSAVED, QSAVED (Projected Savings from various sources)**: These variables represent the estimated savings from implemented recommendations, crucial for calculating total potential savings.

Variables were chosen based on their relevance to energy consumption and savings potential.

### Data Processing

The dataset underwent several preprocessing steps:

- **Filtering**: Entries with missing or irrelevant NAICS codes and industry titles were excluded.
- **Aggregation**: Data were aggregated based on industry and recommendation code.
- **Handling Missing Values**: Missing values in savings projections were imputed using the median savings of similar recommendations within the same industry.

### Sample Selection

The sample included all available assessments from IACs across the United States to maximize generalizability and applicability across the manufacturing sector.

### Statistical Methods and Technical Decisions

- **Descriptive Analysis**: Calculating descriptive statistics to understand the key variables' distribution.
- **Bar Graphs and Visualizations**: Employed for displaying the impact of different recommendations across industries.
- **Top Five Analysis**: Focused on the top five industries and recommendations based on count and potential savings.

### Trade-offs and Decision Rationale

- **Handling of Missing Values**: Imputing missing values was preferred over removing entries, preserving the sample size but potentially introducing bias.
- **Variable Selection**: Limiting the scope to key variables focused the analysis but excluded detailed operational data.

This methods section outlines the steps taken to prepare, process, and analyze the IAC data, emphasizing maintaining data integrity and relevance to the study's goals. The chosen methods balance thoroughness with practical constraints, aiming to provide insightful and actionable results.

# Graphs and Setup

## Setting up Dataframe

We needed to create a sub tibble in order to stack the assessment sheets into one dataframe. We keep all variables for this.
```{r}
all_reccs <- tibble()
for(sheet_name in sheet_names[2:7]){
  print(sheet_name)
  all_reccs <- bind_rows(all_reccs, data_frames[[sheet_name]])
}
nrow(all_reccs)
print(sheet_names)

```

## Joining the Data

Here we created the dataframe and joined the Assess sheet, the combined recc sheet, the NACIS sheet, and the ARC code sheet. We cleaned the data by making all the states abbrivations uppercase and combining the Fiscal year columns that were duplicated in the database. 
```{r}
joined_frames <- left_join(data_frames[["ASSESS"]], naics_codes, "NAICS")
all_reccs <- left_join(all_reccs, arc_codes, c("ARC2"= "Code"))
joined_frames <- left_join(joined_frames, all_reccs, "ID")

joined_frames <- joined_frames %>% 
  mutate(STATE = toupper(STATE)) %>% 
  select(!FY.y)

joined_frames$STATE <- toupper(joined_frames$STATE)
names(joined_frames)[names(joined_frames) == 'FY.x'] <- 'FY'
head(joined_frames)

```

# Results

## Number of Assessments by State

Our analysis of the IAC data revealed significant variations in the number of energy assessments conducted across different states. This distribution highlights both regional trends in energy efficiency initiatives and the varying levels of industrial activity in different parts of the United States.

The distribution of assessments by state was visualized using a choropleth map, which clearly illustrated the geographical spread and intensity of assessments. This visualization aids in quickly identifying which regions are leading in energy assessments and which may require more attention and resources.

Washington state in the least served state on the West Coast and can benefit from more assessments.


```{r}

state_lookup <- data.frame(
  abbrev = state.abb,
  full_name = state.name
)

# Ensure the names are in lowercase for consistent matching
state_lookup$abbrev <- tolower(state_lookup$abbrev)
state_lookup$full_name <- tolower(state_lookup$full_name)

state_summary <- joined_frames %>%
  group_by(STATE) %>%
  summarise(assessments = n(), .groups = 'drop')  # Count of assessments


state_summary <- state_summary %>%
  mutate(region = tolower(STATE)) %>%
  left_join(state_lookup, by = c("region" = "abbrev")) %>%
  mutate(region = ifelse(is.na(full_name), region, full_name)) %>%
  select(-full_name, -STATE)  # Clean up unnecessary columns

# Get state map data
states_map <- map_data("state")
states_map$region <- tolower(states_map$region)

# Merge the summarized data with the map data
map_data <- merge(states_map, state_summary, by = "region", all.x = TRUE)

# Create the choropleth map
choropleth_map <- ggplot(map_data, aes(long, lat, group = group, fill = assessments)) +
  geom_polygon(color = "white") +
  scale_fill_gradient(low = "white", high = "blue", na.value = "grey") +
  coord_fixed(1.3) +
  labs(fill = "Number of Assessments") +
  ggtitle("Number of Assessments by State") +
  theme_minimal()

print(choropleth_map)

```



## Energy Costs by State Across the USA

This section of the report examines the average energy costs incurred by companies across different states following assessments conducted by Industrial Assessment Centers (IACs). The aim was to identify state-specific trends in energy expenditures and to evaluate how states' cost very. The graph does have some outliers since only the biggest companies were assessed.

```{r}
# Bar Plot of Total Energy Costs by Plant
# Calculate total energy costs for each center
energy_cost_columns <- c("EC_plant_cost", "E2_plant_cost", "E3_plant_cost", "E4_plant_cost", "E5_plant_cost", 
                         "E6_plant_cost", "E7_plant_cost", "E8_plant_cost", "E9_plant_cost", "E10_plant_cost", 
                         "E11_plant_cost", "E12_plant_cost")
joined_frames %>% 
  filter(is.na(PSAVED)) %>% 
  nrow()

total_saving <- data_frames[["ASSESS"]] %>%
  filter(!is.na(STATE)) %>% 
  group_by(ID) %>%
  mutate(total_saving = sum(EC_plant_cost, E2_plant_cost, E3_plant_cost, E4_plant_cost, E5_plant_cost, 
                         E6_plant_cost, E7_plant_cost, E8_plant_cost, E9_plant_cost, E10_plant_cost, 
                         E11_plant_cost, E12_plant_cost, na.rm = TRUE))


total_saving <-  total_saving %>%
  group_by(STATE) %>%
  summarize(TOTALPSAVED = mean(total_saving))

  
total_saving %>% 
  ggplot(aes(x = STATE, y = TOTALPSAVED, fill = STATE == "WA")) +
  geom_bar(stat = "identity", linewidth = 1, position = position_dodge2()) +
  labs(title = "Average Energy Cost by State",
       x = "State",
       y = "Average Energy Cost", 
       fill = "Washington") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 5)) +
  theme(legend.position = "none") +
  scale_y_continuous(labels = label_dollar())
  
# +
#   scale_fill_gradient(low = "purple", high = "gold", na.value = "grey")
```

## Most Assessed Industries by Centers in Washington

This section of the report examines the distribution of industrial assessments conducted by various Industrial Assessment Centers (IACs) across Washington State. The analysis looks at the count of assessments for the most assessed industries by BS, OR, and UW IACS.

The analysis of the most assessed industries by IAC centers in Washington demonstrates an alignment of assessment activities with key regional industries. This alignment not only helps in optimizing resource allocation for energy assessments but also in directing attention to sectors where energy efficiency improvements can have significant economic impacts. Moving forward, it would be beneficial for IACs to continue focusing on these key industries while also exploring opportunities in less frequently assessed sectors that might benefit from energy optimization.



```{r}
# Highest count NAICS code, grouped by Center
joined_frames %>% 
  filter(STATE == "WA") %>% 
  select(CENTER, NAICS, STATE, US_TITLE) %>% 
  group_by(CENTER) %>%
  na.omit() %>%
  count(US_TITLE, na.rm = TRUE) %>%
  filter(rank(desc(n)) < 5) %>%
  # Change the fill name to the actual product
  ggplot(aes(x = CENTER, y = n, fill = factor(US_TITLE))) +
  geom_bar(stat = "identity", position = position_dodge()) +
  labs(title = "Most Assessed Industries by Centers in Washington",
       x = "Center",
       y = "Report Count",
       fill = "Industry"
       )
```

## Total Yearly Sales by Companies Assessed by Washington Based Centers

This section presents an analysis of the total yearly sales achieved by companies that underwent assessments by various Industrial Assessment Centers (IACs) in Washington. The graph tracks sales from 1990 through the present, offering insights into economic trends and the performance of these companies over three decades.

The bar graph visualizes the total yearly sales, differentiated by assessment center: BS, OR, and UW. Each center's data is represented by a unique color, making it possible to trace the sales trends associated with each center over time.

The trends in total yearly sales of companies assessed by IACs in Washington highlight the significant role these centers play in boosting company performance. Understanding these trends helps in appreciating the direct economic impact of energy assessments and can guide future strategic planning for both the centers and the industries they serve. The data suggests that while all centers contribute positively, tailored strategies that consider specific regional and industrial characteristics may enhance the effectiveness of these assessments.

```{r}
# Tracking Savings per fiscal year
joined_frames %>% 
  filter(STATE == "WA") %>% 
  select(SUPERID, ID, NAICS, CENTER, SALES, FY) %>% 
  filter(!is.na(SALES)) %>% 
  group_by(CENTER, FY) %>%
  summarize(SALES_TOTAL = sum(SALES)) %>%
  ggplot(aes(x = FY, y = SALES_TOTAL, fill = CENTER)) +
  geom_bar(stat = "identity", size = 2) +
  ggtitle("Total Yearly Sales by Companies \nAssessed by Washington Based Centers") +
  labs(x = "Fiscal Year",
       y = "Total Yearly Sales",
       fill = "Assesment Center"
       ) +
  scale_y_continuous(labels = label_dollar()) +
  theme(text = element_text(size=15))
```

## Total Costs Savings from Reccomendations for Companies Assessed by Washington Based Centers

This section of the report examines the total yearly cost savings achieved by companies as a result of recommendations made by Industrial Assessment Centers (IACs) based in Washington State. The graph provided spans from 1990 to the present, offering a long-term perspective on the financial impact of these recommendations.

The bar graph categorizes cost savings by the assessment center (BS, OR, UW), each represented by different colors. This visualization allows for an easy comparison of performance over time and across different centers.

There was a remarkable peak in cost savings around the year 2000, particularly noted by the OR center, which reported savings exceeding $1 billion. This peak possibly correlates with a combination of high industrial activity and the implementation of significant energy-efficient technologies and practices recommended by the center.

The trends observed in the total yearly cost savings underscore the substantial financial benefits that can be achieved through targeted recommendations provided by IACs. This analysis not only demonstrates the direct economic benefits of such recommendations but also highlights the potential for future savings as industries continue to innovate and adopt more efficient practices. Centers are encouraged to adapt their strategies based on these insights to maximize the economic impact of their assessments.


```{r}
joined_frames %>% 
  filter(STATE == "WA") %>% 
  select(SUPERID, ID, NAICS, CENTER, FY, PSAVED, SSAVED, TSAVED, QSAVED) %>% 
  group_by(CENTER, FY) %>% 
  mutate(TOTAL_SAVED = sum(PSAVED, SSAVED, TSAVED, QSAVED, na.rm = TRUE)) %>%
  ggplot(aes(x = FY, y = TOTAL_SAVED, fill = CENTER)) +
  geom_bar(stat = "identity", size = 2) +
  labs(title = "Total Costs Savings from Reccomendations for \nCompanies Assessed by Washington Based Centers",
       x = "Fiscal Year",
       y = "Total Yearly Savings Over All Resources",
       fill = "Assesment Center"
       ) +
  scale_y_continuous(labels = label_dollar()) +
  theme(text = element_text(size=15))
```

## Earning back a percentage of their revenue in Savings

This section of the report analyzes the efficiency of energy-saving recommendations provided by Washington-based Industrial Assessment Centers (IACs) by examining the savings as a percentage of total yearly sales of the companies assessed. This metric provides a clear indicator of the financial impact relative to company size and revenue.

The graph displays the proportion of yearly sales that corresponds to savings achieved through energy efficiency measures recommended by the centers BS, OR, and UW over three decades, starting from 1990.

The analysis of savings as a percentage of sales provides valuable insights into the cost-effectiveness of energy-saving measures recommended by IACs. While significant peaks suggest periods of high return on investment, the overall trend indicates that ongoing, moderate improvements are more common. For future recommendations, centers may benefit from balancing ambitious energy-saving measures with realistic, sustainable practices that provide steady returns over time.


```{r}
joined_frames %>% 
  filter(STATE == "WA") %>% 
  select(CENTER, FY, PSAVED, SSAVED, TSAVED, QSAVED, SALES) %>% 
  group_by(CENTER, FY) %>% 
  mutate(TOTAL_SAVED = sum(PSAVED, SSAVED, TSAVED, QSAVED, na.rm = TRUE)) %>%
  mutate(SALES_TOTAL = sum(SALES, na.rm = TRUE)) %>%
  mutate(SAVED_TO_SALES = TOTAL_SAVED/SALES_TOTAL) %>% 
  ggplot(aes(x = FY, y = SAVED_TO_SALES, fill = CENTER)) +
  geom_bar(stat = "identity", size = 2) +
  labs(title = "Savings as Percentage of Sales",
       x = "Fiscal Year",
       y = "Total Yearly Savings Over All Resources",
       fill = "Assesment Center"
       ) +
  #scale_y_continuous(labels = label_dollar()) +
  theme(text = element_text(size=15))
```

## Top 5 Recommendations by Savings Across Top 5 Industries in Washington

This section of the report explores the total savings achieved by implementing the top five recommendations across five major industries. The analysis aims to highlight the most financially impactful recommendations provided by the assessment centers and their application across different sectors.

The graph provides a detailed comparison of total savings attributed to each recommendation across the top five industries, allowing us to pinpoint which measures are most effective in terms of cost savings.

The data clearly shows that certain recommendations, while universally applicable, can have varying levels of impact depending on the industry. This variability underscores the importance of industry-specific adaptations and the potential for tailored energy efficiency improvements.

The analysis of the top five recommendations by savings across various industries reveals critical insights into the types of interventions that yield the most significant financial returns. These findings are invaluable for companies looking to invest in energy efficiency improvements and for IACs aiming to refine their advisory strategies to focus on the most impactful recommendations. Moving forward, leveraging this data can guide strategic decisions in energy management and operational improvements across diverse industrial landscapes.

This results section offers a comprehensive analysis of the data shown in the graph, providing a clear narrative about the economic benefits of specific energy-saving measures and their varied impacts across different industries. By detailing these observations and their broader implications, the section not only addresses the research questions but also enhances the reader's understanding of the potential for targeted energy efficiency initiatives.

```{r}

# Identifying top 5 industries by number of entries
Top5groups <- joined_frames %>%
  filter(!is.na(US_TITLE), !is.na(NAICS), STATE == "WA") %>%
  count(US_TITLE) %>%
  arrange(desc(n)) %>%
  slice_head(n = 5)

# Prepare data for graphing, including only top five recommendations per industry
graphed <- joined_frames %>%
  select(US_TITLE, ARC2, PSAVED, SSAVED, TSAVED, QSAVED, Description) %>%
  filter(US_TITLE %in% Top5groups$US_TITLE) %>%
  mutate(TOTAL_SAVED = PSAVED + SSAVED + TSAVED + QSAVED) %>%
  group_by(US_TITLE, ARC2, Description) %>%
  summarize(TOTAL_SAVED = sum(TOTAL_SAVED, na.rm = TRUE), .groups = 'drop') %>%
  arrange(US_TITLE, desc(TOTAL_SAVED)) %>%
  group_by(US_TITLE) %>%
  slice_head(n = 5) %>%
  ungroup() %>%
  mutate(ARC2 = factor(ARC2))  # Factor conversion here for better control

# Create the plot
ggplot(graphed, aes(x = ARC2, y = TOTAL_SAVED, fill = Description)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  facet_wrap(~US_TITLE, scales = "free_x") +
  labs(title = "Top 5 Recommendations by Savings Across Top 5 Industries",
       x = "Recommendation Code", y = "Total Savings", fill = "Recommendation") +
  scale_y_continuous(labels = label_dollar())
  theme(axis.text.x = element_text(angle = 45, hjust = 1), 
        text = element_text(size = 12))  # Adjusting text size 


```


```{r}
# For UW, Savings per year by industry/energy type
# Going to use Primary Energy type, as is mainly the focus
joined_frames %>% 
  filter(CENTER == "UW") %>% 
  select(FY, PSOURCCODE, PSAVED) %>% 
  filter(substr(PSOURCCODE, 1, 1) == "E") %>% 
  group_by(FY, PSOURCCODE) %>% 
  summarize(SAVED_SUM = sum(PSAVED, na.rm = TRUE)) %>% 
  ggplot(aes(x = factor(FY), y = SAVED_SUM, fill = factor(PSOURCCODE))) +
  geom_bar(stat = "identity", size = 3, position = position_dodge()) +
  labs(title = "Total Saved by Energy Type for the UW Center",
       x = "Fiscal Year",
       y = "Saved Money by Primary Energy Type",
       color = "Primary Source of Energy"
       ) +
  scale_y_continuous(labels = label_dollar()) +
  theme(text = element_text(size=10)) +
  guides(color = guide_legend(ncol = 2))

```
We can see that in general, the category that has the most savings associated with it is EC, which represents Electrical Consumption, or in other words, how much electricity is used by the company in a given year. However, the reason that this category has the highest savings is because the UW center's main focus is on electrical consumption. If we also look at the amount of reccomendations for each energy type, we can see that a majority of reccomendations are aimed at improving savings on Electrical Consumption.

```{r}
# For UW, Savings per year by industry/energy type
# Going to use Primary Energy type, as is mainly the focus
joined_frames %>% 
  filter(CENTER == "UW") %>% 
  select(FY, PSOURCCODE, PSAVED) %>% 
  filter(substr(PSOURCCODE, 1, 1) == "E") %>% 
  group_by(PSOURCCODE) %>%
  summarize(count = n())

```

If we look at the data without Electrical Consumption:

```{r}
# For UW, Savings per year by industry/energy type
# Going to use Primary Energy type, as is mainly the focus
joined_frames %>% 
  filter(CENTER == "UW") %>% 
  select(FY, PSOURCCODE, PSAVED) %>% 
  filter(substr(PSOURCCODE, 1, 1) == "E") %>% 
  filter(PSOURCCODE != "EC") %>% 
  group_by(FY, PSOURCCODE) %>% 
  summarize(SAVED_SUM = sum(PSAVED, na.rm = TRUE)) %>% 
  ggplot(aes(x = FY, y = SAVED_SUM, color = factor(PSOURCCODE))) +
  geom_point(stat = "identity", size = 3) +
  labs(title = "Total Saved by Energy Type for the UW Center",
       x = "Fiscal Year",
       y = "Saved Money by Primary Energy Type",
       color = "Primary Source of Energy"
       ) +
  scale_y_continuous(labels = label_dollar()) +
  theme(text = element_text(size=10)) +
  guides(color = guide_legend(ncol = 2))

```
We can see that the most savings is again, the one with the second most recommendations, which is E2, or Natural Gas Consumption.


# Discussion

# Summary